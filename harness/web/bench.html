<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAssembly Benchmark Harness</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            margin: 0;
            padding: 20px;
            font-size: 12px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .status {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 5px;
            background: #333;
            border-radius: 3px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #ffff00);
            width: 0%;
            transition: width 0.3s ease;
        }
        .results {
            margin: 20px 0;
            padding: 10px;
            background: #222;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
        }
        .log {
            font-size: 10px;
            color: #888;
            margin: 2px 0;
        }
        .error {
            color: #ff4444;
        }
        .success {
            color: #44ff44;
        }
        .warning {
            color: #ffff44;
        }
        #memory-usage {
            color: #ff8800;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü¶Ä WASM BENCHMARK HARNESS üêπ</h1>
            <div>Rust vs TinyGo Performance Comparison</div>
        </div>
        
        <div class="status">
            <span>Status: <span id="status">Initializing...</span></span>
            <span>Memory: <span id="memory-usage">0 MB</span></span>
            <span>Time: <span id="elapsed-time">0.0s</span></span>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>
        
        <div class="status">
            <span>Task: <span id="current-task">None</span></span>
            <span>Language: <span id="current-lang">None</span></span>
            <span>Run: <span id="current-run">0/0</span></span>
        </div>
        
        <div class="results" id="results">
            <div class="log">Benchmark harness initialized. Waiting for commands...</div>
        </div>
        
        <div class="status">
            <span>Total Runs: <span id="total-runs">0</span></span>
            <span>Successful: <span id="successful-runs">0</span></span>
            <span>Failed: <span id="failed-runs">0</span></span>
        </div>
    </div>

    <!-- WebAssembly modules will be loaded here -->
    <div id="wasm-container" class="hidden"></div>
    
    <!-- Load benchmark modules -->
    <script type="module" src="./wasm_loader.js"></script>
    <script type="module" src="./config_loader.js"></script>
    <script type="module" src="./bench.js"></script>
    
    <script>
        // Global state for Puppeteer communication
        window.benchmarkState = {
            status: 'initializing',
            progress: 0,
            currentTask: null,
            currentLang: null,
            currentRun: 0,
            totalRuns: 0,
            successfulRuns: 0,
            failedRuns: 0,
            results: [],
            memoryUsage: 0,
            startTime: performance.now()
        };
        
        // Update UI elements
        function updateUI() {
            const state = window.benchmarkState;
            document.getElementById('status').textContent = state.status;
            document.getElementById('current-task').textContent = state.currentTask || 'None';
            document.getElementById('current-lang').textContent = state.currentLang || 'None';
            document.getElementById('current-run').textContent = `${state.currentRun}/${state.totalRuns}`;
            document.getElementById('total-runs').textContent = state.totalRuns;
            document.getElementById('successful-runs').textContent = state.successfulRuns;
            document.getElementById('failed-runs').textContent = state.failedRuns;
            document.getElementById('progress').style.width = `${state.progress}%`;
            document.getElementById('elapsed-time').textContent = `${((performance.now() - state.startTime) / 1000).toFixed(1)}s`;
            
            // Update memory if available
            if (performance.memory) {
                const memMB = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(1);
                document.getElementById('memory-usage').textContent = `${memMB} MB`;
                state.memoryUsage = parseFloat(memMB);
            }
        }
        
        // Log function for results
        window.logResult = function(message, type = 'log') {
            const resultsDiv = document.getElementById('results');
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.textContent = `[${new Date().toISOString().slice(11, 23)}] ${message}`;
            resultsDiv.appendChild(logDiv);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        };
        
        // Periodic UI updates
        setInterval(updateUI, 100);
        
        // Initial log
        window.logResult('Benchmark harness loaded successfully', 'success');
    </script>
</body>
</html>